!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).draggable=t()}(this,function(){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t){var n,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){s=!0,o=e},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw o}}}}return function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.group=e.group,this.scroll=e.scroll||e.group,this.draggable=e.draggable,this.dragEnd=e.dragEnd,this.ghostStyle=e.ghostStyle,this.ghostClass=e.ghostClass,this.animation=e.animation||300,this.rectList=[],this.isMousedown=!1,this.isMousemove=!1,this.drag={element:null,index:0,lastIndex:0},this.drop={element:null,index:0,lastIndex:0},this.ghost={element:null,x:0,y:0,exist:!1},this.diff={old:{node:null,rect:{}},new:{node:null,rect:{}}},this._debounce(this.init(),50)}var e,n,i;return e=t,(n=[{key:"init",value:function(){this.group?(this._bindEventListener(),this._getChildrenRect()):console.error("Error: groupElement is required")}},{key:"destroy",value:function(){this._unbindEventListener(),this._resetState()}},{key:"_getChildrenRect",value:function(){this.rectList.length=0;var e,t=r(this.group.children);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.rectList.push(n.getBoundingClientRect())}}catch(e){t.e(e)}finally{t.f()}}},{key:"_handleMousedown",value:function(e){var s=this;if(0!==e.button)return!0;if(e.target===this.group)return!0;this.rectList.length||this._getChildrenRect();try{var t=this.draggable?this.draggable(e):e.target;if(!t)return!0;this.drag.element=t}catch(e){return!0}this.isMousedown=!0;var l={x:e.clientX,y:e.clientY},t=(this.ghost.element=this.drag.element.cloneNode(!0),this._getElementIndex());this.diff.old.rect=this.rectList[t],this.ghost.x=this.rectList[t].left,this.ghost.y=this.rectList[t].top,this.drag.index=t,this.drag.lastIndex=t,document.onmousemove=function(e){if(s._initCloneElement(),s._handleCloneMove(),e.preventDefault(),s.isMousedown){s.isMousemove=!0,s.ghost.x+=e.clientX-l.x,s.ghost.y+=e.clientY-l.y,l.x=e.clientX,l.y=e.clientY,s._handleCloneMove();for(var t=0;t<s.rectList.length;t++){var n=s.rectList[t],i=n.left,o=n.right,r=n.top,n=n.bottom;if(e.clientX>i&&e.clientX<o&&e.clientY>r&&e.clientY<n){s.drop.element=s.group.children[t],s.drop.lastIndex=t,s.drag.element!==s.drop.element&&(s.drag.index<t?(s.group.insertBefore(s.drag.element,s.drop.element.nextElementSibling),s.drop.index=t-1):(s.group.insertBefore(s.drag.element,s.drop.element),s.drop.index=t+1),s.drag.index=t,s._animate(s.drag.element,s.rectList[s.drag.index],s.rectList[s.drag.lastIndex]),s._animate(s.drop.element,s.rectList[s.drop.index],s.rectList[s.drop.lastIndex]),s.drag.lastIndex=t,s.diff.old.node=s.drag.element,s.diff.new.node=s.drop.element),s.diff.new.rect=s.rectList[t];break}}}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,s.isMousedown&&s.isMousemove&&s.dragEnd&&s.dragEnd(s.diff.old,s.diff.new),s.isMousedown=!1,s.isMousemove=!1,s._destroyClone(),s._clearDiff()}}},{key:"_initCloneElement",value:function(){for(var e in this.ghost.element.class=this.ghostClass,this.ghost.element.style.transition="none",this.ghost.element.style.position="fixed",this.ghost.element.style.left=0,this.ghost.element.style.top=0,this.ghostStyle)this._styled(this.ghost.element,e,this.ghostStyle[e]);this.ghost.element.exist||(document.body.appendChild(this.ghost.element),this.ghost.element.exist=!0)}},{key:"_handleCloneMove",value:function(){this.ghost.element.style.transform="translate3d(".concat(this.ghost.x,"px, ").concat(this.ghost.y,"px, 0)")}},{key:"_destroyClone",value:function(){this.ghost.element&&this.ghost.element.remove(),this.ghost={element:null,x:0,y:0,exist:!1}}},{key:"_getElementIndex",value:function(){var e=Array.from(this.group.children),t=this.drag.element,n=e.indexOf(t);if(-1<n)return n;for(var i=0;i<e.length;i++)if(this._isChildOf(t,e[i]))return i}},{key:"_isChildOf",value:function(e,t){var n;if(e&&t)for(n=e.parentNode;n;){if(t===n)return!0;n=n.parentNode}return!1}},{key:"_animate",value:function(e,t,n){var i=this;this._styled(e,"transition","none"),this._styled(e,"transform","translate3d(".concat(n.left-t.left,"px, ").concat(n.top-t.top,"px, 0)")),e.offsetLeft,this._styled(e,"transition","all ".concat(this.animation,"ms")),this._styled(e,"transform","translate3d(0px, 0px, 0px)"),clearTimeout(e.animated),e.animated=setTimeout(function(){i._styled(e,"transition",""),i._styled(e,"transform",""),e.animated=null},this.animation)}},{key:"_styled",value:function(e,t,n){var i=e&&e.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];i[t=t in i?t:"-webkit-"+t]=n+("string"==typeof n?"":"px")}}},{key:"_resetState",value:function(){this.isMousedown=!1,this.isMousemove=!1,this.rectList.length=0,this.drag={element:null,index:0,lastIndex:0},this.drop={element:null,index:0,lastIndex:0},this._destroyClone(),this._clearDiff()}},{key:"_clearDiff",value:function(){this.diff={old:{node:null,rect:{}},new:{node:null,rect:{}}}}},{key:"_bindEventListener",value:function(){this._handleMousedown=this._handleMousedown.bind(this),this._getChildrenRect=this._getChildrenRect.bind(this),this.group.addEventListener("mousedown",this._handleMousedown),this.scroll.addEventListener("scroll",this._debounce(this._getChildrenRect,50)),window.addEventListener("scroll",this._debounce(this._getChildrenRect,50)),window.addEventListener("resize",this._debounce(this._getChildrenRect,50)),window.addEventListener("orientationchange",this._debounce(this._getChildrenRect,50))}},{key:"_unbindEventListener",value:function(){this.group.removeEventListener("mousedown",this._handleMousedown),this.scroll.removeEventListener("scroll",this._getChildrenRect),window.removeEventListener("scroll",this._getChildrenRect),window.removeEventListener("resize",this._getChildrenRect),window.removeEventListener("orientationchange",this._getChildrenRect)}},{key:"_debounce",value:function(o,r){return function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];clearTimeout(o.id),o.id=setTimeout(function(){o.call.apply(o,[e].concat(n))},r)}}}])&&o(e.prototype,n),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()});
